{"version":3,"sources":["webpack:///./routes/chat/style.css","webpack:///./routes/chat/index.tsx"],"names":["ChatItem","props","item","Chat","ref","createRef","inputRef","statusRef","useState","items","setItems","useEffect","renderCallbackID","element","current","inputElement","statusElement","paused","connected","mouseDown","mouseLeftDownY","g","lastMessage","position","velocity","acceleration","handleBlur","window","addEventListener","handleFocus","handleMouseDown","event","button","clientY","preventDefault","handleMouseUp","focus","handleContextMenu","handleMouseMove","style","backgroundPosition","render","setTimeout","requestAnimationFrame","Math","abs","random","update","params","value","encodeURIComponent","fetch","then","res","json","data","innerText","display","catch","err","console","error","alert","location","reload","cancelAnimationFrame","removeEventListener","class","Helmet","title","autofocus","map","key"],"mappings":"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","file":"route-chat.chunk.d4414.js","sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"chat\":\"chat__whrty\"};","import { FunctionalComponent, createRef, h } from 'preact'\nimport { useEffect, useState } from 'preact/hooks'\nimport Helmet from 'react-helmet'\nimport style from './style.css'\n\n// https://preactjs.com/repl/\n\n// type ChatMessage = {\n//   color: string;\n//   body: string;\n// }\n\ninterface ChatItemProps {\n  item: string;\n}\n\nconst ChatItem: FunctionalComponent<ChatItemProps> = (props: ChatItemProps) => {\n  const { item } = props\n  return (\n    <li>{item}</li>\n  )\n  /*\n  return (\n    <li>{inner.color} {inner.body}</li>\n  )\n  */\n}\n\nconst Chat: FunctionalComponent = () => {\n  const ref = createRef<HTMLElement>()\n  const inputRef = createRef<HTMLInputElement>()\n  const statusRef = createRef<HTMLParagraphElement>()\n  //const [items, setItems] = useState<ChatMessage[]>([])\n  const [items, setItems] = useState<string[]>([])\n\n  useEffect(() => {\n    const element = ref.current as HTMLElement\n    const inputElement = inputRef.current as HTMLInputElement\n    const statusElement = statusRef.current as HTMLParagraphElement\n    let paused = false\n    let connected = false\n    let mouseDown = 0\n    let mouseLeftDownY = 0\n    let g = 0\n    let lastMessage = ''\n    let renderCallbackID: number\n    let position = 0\n    let velocity = 1\n    let acceleration = 0\n    \n    const handleBlur = (): void => {\n      paused = true\n    }\n    window.addEventListener('blur', handleBlur)\n\n    const handleFocus = (): void => {\n      paused = false\n    }\n    window.addEventListener('focus', handleFocus)\n\n    const handleMouseDown = (event: MouseEvent): boolean => {\n      mouseDown |= (1<<event.button)\n      if (event.button===0) {\n        mouseLeftDownY = event.clientY\n      }\n      event.preventDefault()\n      return false\n    }\n    window.addEventListener('mousedown', handleMouseDown)\n\n    const handleMouseUp = (event: MouseEvent): boolean => {\n      mouseDown ^= (1<<event.button)\n      if (event.button===0) {\n        position = event.clientY + mouseLeftDownY\n        velocity = 0.06 * (position - g)\n        acceleration = 0\n      }\n      // c = e.clientY + o\n      // v = .06*(c-g);\n      // a = 0\n      inputElement.focus()\n      event.preventDefault()\n      return false\n    }\n    window.addEventListener('mouseup', handleMouseUp)\n\n    const handleContextMenu = (event: MouseEvent): boolean => {\n      event.preventDefault()\n      return false\n    }\n    window.addEventListener('contextmenu', handleContextMenu)\n\n    const handleMouseMove = (event: MouseEvent): void => {\n      if (mouseDown&1) {\n        const position = event.clientY + mouseLeftDownY\n        element.style.backgroundPosition = `0 ${position}px`\n      }\n    }\n    window.addEventListener('mousemove', handleMouseMove)\n\n    const draw = (): void => {\n      if (!(mouseDown&1)) {\n        velocity += acceleration\n        position += velocity\n        if (Math.abs(velocity) > 32 && velocity * acceleration >= 0) {\n          acceleration =  -velocity * Math.random() / 128\n        }\n        element.style.backgroundPosition = `0 ${position}px`\n      }\n      else {\n        g = mouseLeftDownY\n      }\n    }\n\n    const render = (): void => {\n      if (paused) {\n        setTimeout(render, 128)\n        return\n      }\n      renderCallbackID = window.requestAnimationFrame(render)\n      draw()\n    }\n    render()\n\n    const update = (): void => {\n      if (paused) {\n        setTimeout(update, 4096)\n        return\n      }\n      let params = ''\n      if (lastMessage!==inputElement.value) {\n        params = `?s=${encodeURIComponent(inputElement.value)}`\n        lastMessage = inputElement.value\n      }\n      fetch(`https://psilly.com/experiments/ajax/chatter_chat.pill${params}`)\n        .then(res => res.json())\n        //.then(res => res.map((v: string) => {'color': v.slice(-6), 'body': v.slice(0, -6)}))\n        //.then(res => res.map((v: string) => [v.slice(-6), v.slice(0, -6)]))\n        .then(data => setItems(data || []))\n        .then(() => {\n          if (!connected) {\n            connected = true\n            statusElement.innerText = ''\n            statusElement.style.display = 'none'\n          }\n        })\n        .then(() => setTimeout(update, 128))\n        .catch(err => {\n          connected = false\n          statusElement.innerText = err as string\n          statusElement.style.display = 'block'\n          console.error(err)\n          alert('Error connecting to server. Check that your connection is working and that you have some disabled cookies like some kind of heathen.')\n          location.reload()\n        })\n    }\n    update()\n\n    statusElement.innerText = 'Connecting...'\n\n    return (): void => {\n      window.cancelAnimationFrame(renderCallbackID)\n      window.removeEventListener('blur', handleBlur)\n      window.removeEventListener('focus', handleFocus)\n      window.removeEventListener('mousedown', handleMouseDown)\n      window.removeEventListener('mouseup', handleMouseUp)\n      window.removeEventListener('contextmenu', handleContextMenu)\n      window.removeEventListener('mousemove', handleMouseMove)\n    }\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  return (\n    <section ref={ref} class={style.chat}>\n      <Helmet title=\"Chatter\" />\n      <input ref={inputRef} autofocus />\n      <ul class=\"output\">\n        {items.map(item => (\n          <ChatItem item={item} key={item} />\n        ))}\n      </ul>\n      <p ref={statusRef} class=\"text-center\">A colourful ape input aggregator.</p>\n    </section>\n  )\n}\n\nexport default Chat\n"],"sourceRoot":""}